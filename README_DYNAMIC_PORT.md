# Klarna Invoice Assistant - 动态端口版本

## 🚀 新特性：智能端口管理

这个版本解决了端口冲突问题，系统会自动找到可用端口并配置前后端连接。

## 📋 启动方式

### 方法1：一键启动（推荐）
```bash
# Windows 批处理文件
smart_start.bat

# 或 PowerShell 脚本
powershell -ExecutionPolicy Bypass -File smart_start.ps1
```

### 方法2：手动启动
```bash
# 1. 启动后端（会自动选择可用端口）
python server.py

# 2. 启动前端
cd frontend
npm run dev
```

## 🔧 工作原理

1. **动态端口分配**：
   - 系统会从8000开始寻找可用端口
   - 如果8000被占用，自动尝试8001、8002...8100
   - 生成端口配置文件 `port_config.json`

2. **自动配置更新**：
   - 后端启动时自动更新 `frontend/config.js`
   - 前端Vite代理自动读取配置并连接到正确端口

3. **零配置连接**：
   - 前端自动识别后端端口
   - 无需手动修改任何配置文件

## 📁 新增文件

- `dynamic_port.py` - 动态端口分配核心模块
- `port_config.json` - 端口配置文件（自动生成）
- `smart_start.bat` - Windows批处理启动脚本
- `smart_start.ps1` - PowerShell启动脚本

## 🌐 访问地址

启动后，查看控制台输出获取正确的访问地址：

```
Backend running on: http://localhost:8001  (或其他可用端口)
Frontend running on: http://localhost:5173   (或其他可用端口)
```

## 🔍 故障排除

### 如果端口仍然冲突
系统会自动尝试下一个端口，最多尝试到8100。

### 如果前端无法连接后端
1. 检查 `port_config.json` 文件是否存在
2. 确认后端控制台显示正确的端口
3. 重新启动服务

### 重置端口配置
删除 `port_config.json` 文件，系统会重新生成。

## 📝 示例输出

**成功启动时你会看到：**
```
========================================
  Klarna Invoice Assistant - Smart Start
========================================

[1/4] 正在清理端口占用...
[2/4] 正在启动后端服务器...
[3/4] 等待后端初始化...
[4/4] 正在启动前端开发服务器...

========================================
  启动完成！
========================================

✅ 后端配置已加载:
   - 后端端口: 8001
   - 后端地址: http://localhost:8001

🌐 前端地址: http://localhost:5173

现在可以打开浏览器访问前端了！
```

---

## 🎉 优势

- ✅ **零端口冲突**：自动寻找可用端口
- ✅ **自动配置**：前后端自动连接
- ✅ **一键启动**：简化启动流程
- ✅ **向后兼容**：不影响原有功能

现在你可以同时运行多个实例，不用担心端口冲突问题！